<div xmlns="http://www.w3.org/1999/xhtml">
  <div>
    <h1 style="font-family: sans-serif; width: 55%; float: left;text-align: left;">Add footnotes to my pages -- a prototype text annotation
  interface</h1>
    <p style="width: 38%; float: left;text-align: right">
      <em>
        <strong>
		Sigfrid Lundberg's Stuff,
	      2009-09-19</strong>
      </em>
    </p>
  </div>
  <div style="clear:both;"> </div>
  <div style="width:100%;">
    <div>

      <p>In order to understand what's going on here, you have have to <a href="http://sigfrid-lundberg.se/footnotes/">visit the
      resource</a>. There is a some scripting going on which cannot be
      syndicated. If you're reading this, you are on the wrong
      page. Sorry.</p>

      <h2>What you can do here</h2>

      <p>There is a link at the top of this page (if you're reading the HTML
      version <a href="http://sigfrid-lundberg.se/footnotes/">directly from my
      site</a>, that is). It says "Show anchors". It's not a very user
      friendly description of what it does, but I cannot figure out a better
      term right now. If you click on it, there will appear a link after most
      words in the text. These are the annotation anchors of this text.</p>

      <p>When visible, the anchors appears as a clickable asterisk '*', and a
      click on one of them activates the usual <a href="disqus.com">disqus.com
      forum</a>. This is by some client side DOM programming.</p>

      <p>Submitting a footnote works, but the script never get the
      acknowledgement from the disqus.com server. I don't know why, but it
      seems that the form doesn't like to live in an iframe.</p>

      <p id="anchor55576b680.592539918884886">My server retrieves the
      annotations from the disqus.com web services and print a list of notes
      at the end of the page. This is done server side, shuch that the
      discussions within the footnotes will be visible by search engines. The
      place of the annotation is marked as a note with a link to the
      notes. You may read the annotation when your mouse is over the link.</p>

      <p>Is this a good idea? Do you like it? Should all my pages have user
      supplied foot notes?</p>
      
      <h2>How is it done</h2>

      <p id="anchor55018b510.584488500647474">In order to add footnotes to a
      text, we need to be able to address individual positions in it. These
      positions are what I'd like to call annotation anchors. I've already
      briefly discussed the problem on how to create identifiers (see a <a href="http://sigfrid-lundberg.se/entries/2009/08/quotations/">A
      quotation is much more than an extract</a>). For this entry I've
      extended the xslt script such that it can <a href="http://exslt.org/str/functions/tokenize/">tokenize</a> html text
      embedded in atom entry documents. It can also add anchors (id
      attributes) on each individual word (produced by the tokenize function)
      in the whole text. We also implement a javascript which expose these
      anchors to users, and allow them to comment more or less arbitrary point
      in the text.</p>

      <p id="anchor55402b10.359095368701543">There is a <strong>big</strong>
      drawback in this procedure; once you have processed your text and the
      anchors are there, then you <strong>must not</strong> change them. Each
      word has become a resource on the internet. Please view the source of
      this document, before you use the stylesheet <kbd><a href="http://sigfrid-lundberg.se/footnotes/atom_anchor_id.xsl">atom_anchor_id.xsl</a></kbd>.</p>

      <pre>
	&lt;span id="anchor54764"&gt;Would&lt;/span&gt;
	&lt;span id="anchor54766"&gt;you&lt;/span&gt;
	&lt;span id="anchor54768"&gt;like&lt;/span&gt;
	&lt;span id="anchor54770"&gt;to&lt;/span&gt;
	&lt;span id="anchor54772"&gt;edit&lt;/span&gt;
	&lt;span id="anchor54774"&gt;this&lt;/span&gt;
	&lt;span id="anchor54778"&gt;text?&lt;/span&gt;
      </pre>

      <p>See what I mean? I cannot author prose like that in my XML
      editor. You wouldn't suffer as much using WYSIWYG tools, but on the hand
      it would presumably destroy the ID-strings.</p>

      <p>When preparing this text, I felt that I had to prepare some
      annotations of my own, and in order to do that I compiled the text,
      published it, made my annotation and then pasted the ID back into the
      source XML in order to be able to continue writing. Formbased proof
      reading of an existing digital text wouldn't be any problem, though.</p>

      <h2>Javascript &amp; DOM scripting</h2>

      <p>You can find the possible anchors by clicking on the link
      <strong>Show anchors</strong>, and hide them again by clicking on
      <strong>Hide anchors</strong> at the same place (there is a
      toggle). There are two javascript functions handling the toggling. The
      possibly most interesting, but also, the most vulnerable, feature is the
      generation of javascript from rss for handling the readable
      notes.</p>

      <pre>
      &lt;script type="text/javascript"&gt;
	    var usedAnchorIds = new Array();
	    var noteTexts     = new Array();
	    
	    usedAnchorIds[0]="anchor55402b10.359095368701543";

	    noteTexts[0]='I had problems obtaining unique id strings from the'
	    +'generate-id() function in XSLT. (siggelundberg, Fri, 18 Sep 2009'
	    +'17:46:27 -0000)';

	    usedAnchorIds[1]="anchor55018b510.584488500647474";

	    noteTexts[1]='This is an arbitrary point in my text. I find this'
	    +'really suitable for adding a footnote. (siggelundberg, Fri, 18 Sep
	    +'2009 03:27:16 -0000)';

	    printNotes(usedAnchorIds,noteTexts);

    &lt;/script&gt;
      </pre>

      <p>The rest of the features are readily visible on this page. You have
      to reaload the page to see the new footnote -- if I implement this I'll
      will refresh those asynchronously.</p>

    </div>
    <p style="text-align: left;"><em><strong>Categories:</strong></em> 
	  <a href="/subjects/structuralwebdesign/">Structural web design</a>,
	    <a href="/subjects/xmlprocessing/">XML Processing</a><br/><em><strong>
		Permalink:
	      </strong></em><a rel="bookmark" href="/footnotes/">http://sigfrid-lundberg.se/footnotes/</a></p>
    <hr width="50%" align="center"/>
  </div>
  <div>
    <h1>Other, not yet obsolete stuff</h1>
    <table class="news">
      <tr>
        <td class="left">2009</td>
        <td class="left"><a href="/entries/2009/09/twelveweeks/"><em>Twelve weeks</em></a><br/>It is twelve weeks since i refurbished and redecorated this
  site. It is time for an evaluation...<br/><a href="/subjects/essays/">Essays</a></td>
      </tr>
      <tr>
        <td class="left">2009</td>
        <td class="left"><a href="/entries/2009/08/diglib/"><em>The predigital library</em></a><br/>What is the strategic goal for a library web site? Could it be to
  put the library on the web, or is it basically to the library's resources
  visible to users anywhere on the globe?<br/><a href="/subjects/structuralwebdesign/">Structural web design</a></td>
      </tr>
      <tr>
        <td class="left">2009</td>
        <td class="left"><a href="/entries/2009/08/whatisabook/"><em>What is a book, and does it matter?</em></a><br/>Lorcan Dempsey of OCLC research, is involved in among lots of
  things, statistical analyses of media use. In that work they are forced to
  make operational definitions of the 'book'.<br/><a href="/subjects/essays/">Essays</a>,
	<a href="/subjects/media/">Media</a></td>
      </tr>
      <tr>
        <td class="left">2009</td>
        <td class="left"><a href="/entries/2009/08/threeyears/"><em>Five years that formed the digital library as we know it:
  1997-2001</em></a><br/>It appeared to me that many the standards and technologies
  underpinning the digital library as we know it were formed during five years
  around the turn of the century.<br/><a href="/subjects/metadata/">Metadata</a></td>
      </tr>
      <tr>
        <td class="left">2009</td>
        <td class="left"><a href="/entries/2009/08/quotations/"><em>A quotation is much more than an extract</em></a><br/>In my last entry, on cool URIs, I discussed the identification of
  documents. The conclusion from that is that people in the library world are
  obsessed by being able to find documents. I take that more serious than most
  other library folk. I'd say that it is our mission to help our patrons find
  a single word in a text, a rectangle in an image and so forth. The time is
  gone when we could tell users: The answer to your question might be in any
  of the books on that shelf.<br/><a href="/subjects/structuralwebdesign/">Structural web design</a></td>
      </tr>
      <tr>
        <td class="left">2009</td>
        <td class="left"><a href="/entries/2009/08/cooluris/"><em>Forgive me, Father, for I have sinned... I have moved a
  document</em></a><br/>The initiatives behind the persistent linking is trying to change
  the status of old documents. From 404 to 200. We've had some success with
  books and journals using ISBN and ISSN numbers. Why not try to copy this to
  the web? But, alas!, library people have in general too little understanding
  of the Worldwide Web. In particular those who advocate persistent
  identifiers.<br/><a href="/subjects/structuralwebdesign/">Structural web design</a></td>
      </tr>
    </table>
  </div>
</div>
